---
- hosts: 2016-test
  gather_facts: no
   
  tasks:

    - name: Validate temp directory
      win_file:
        path: \\2016-test\c$\Temp
        state: directory

    - name: Copy source files  
      win_copy:
        src: \\dc1\C$\Temp\2022
        dest: \\2016-test\C$\Temp 
        force: no

    - name: Run Windows setup
      win_command: \\2016-test\C$\Temp\Setup.exe /unattend:\\2016-test\C$\Temp\unattend.xml
      register: setup_process

    - name: Check setup result 
      debug:
       msg: "Setup exit code: {{ setup_process.rc }} "

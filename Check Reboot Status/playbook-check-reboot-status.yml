- hosts: all

  tasks:
    - name: Check if reboot is pending
      win_shell: "(Get-CimInstance -ClassName Win32_OperatingSystem).RebootRequired"
      register: reboot_pending_result

    - name: Output reboot status
      debug:
        msg: >
          {% if reboot_pending_result.stdout is defined and reboot_pending_result.stdout == 'True' -%}
            Reboot pending
          {%- else -%}  
            No reboot needed
          {%- endif %}

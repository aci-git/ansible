---
- hosts: all
  tasks:
    - name: List available updates
      ansible.windows.win_updates:
        state: searched
      register: update_list

    - name: Show updates
      debug:
        var: update_list.updates

    - name: Install Updates
      ansible.windows.win_updates:
        state: installed
        reboot: no
        log_path: C:\ansible_wu.log

    - name: Update installed
      win_updates:
        category_names:
          - CriticalUpdates
          - DefinitionUpdates
          - SecurityUpdates
          - UpdateRollups
          - Updates
        state: installed
        reboot: no
        log_path: C:\ansible_wu.log

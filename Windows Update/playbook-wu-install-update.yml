---
- name: Windows Update
  hosts: rdc-dev-01.affordablecare.com
  gather_facts: no
  
  vars:
    update_log: C:\Windows\Temp\ansible-win-updates.log 
    async_dir: C:\Windows\Temp

  tasks:
    - name: Check for Windows updates  
      win_updates:
        state: searched
        log_path: "{{ update_log }}"
      register: update_list

    - name: Install Windows updates
      win_updates:
        state: installed
        log_path: "{{ update_log }}"
      async: 7200
      poll: 60
      register: win_update

    - name: Wait for update install to complete
     async_status:
       jid: "{{ win_update.ansible_job_id }}"
     register: job_result
     until: job_result.finished
     retries: 300

    - debug:  
        var: win_update
